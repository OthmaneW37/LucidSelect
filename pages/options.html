<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Options - LucidSelect</title>
  <link rel="stylesheet" href="../styles/new-features.css">
</head>
<body>
  <div class="options-container">
    <h1 class="section-title" data-i18n="options.title">Options LucidSelect</h1>
    <p class="section-description" data-i18n="options.description">Configurez les paramètres de l'extension LucidSelect.</p>
    
    <div class="options-navigation">
      <div class="nav-tabs">
        <button class="nav-tab active" data-tab="general" data-i18n="options.general_tab">Général</button>
        <button class="nav-tab" data-tab="ai-models" data-i18n="options.ai_models_tab">Modèles d'IA</button>
        <button class="nav-tab" data-tab="custom-prompts" data-i18n="options.custom_prompts_tab">Prompts personnalisés</button>
        <button class="nav-tab" data-tab="history" data-i18n="options.history_tab">Historique</button>
        <button class="nav-tab" data-tab="language" data-i18n="options.language_tab">Langue</button>
        <button class="nav-tab" data-tab="about" data-i18n="options.about_tab">À propos</button>
      </div>
    </div>
    
    <div class="tab-content">
      <!-- Onglet Général -->
      <div class="tab-pane active" id="general">
        <h2 class="section-title" data-i18n="options.general_settings">Paramètres généraux</h2>
        
        <div class="form-group">
          <label for="default-model" data-i18n="options.default_model">Modèle d'IA par défaut :</label>
          <select id="default-model" class="form-input">
            <option value="openai" data-i18n="options.openai">OpenAI</option>
            <option value="together" data-i18n="options.together">Together.ai</option>
            <option value="claude" data-i18n="options.claude">Claude (Anthropic)</option>
            <option value="gemini" data-i18n="options.gemini">Gemini (Google)</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="default-language" data-i18n="options.default_language">Langue par défaut :</label>
          <select id="default-language" class="form-input">
            <!-- Les options de langue seront ajoutées dynamiquement -->
          </select>
        </div>
        
        <div class="form-group">
          <label data-i18n="options.appearance">Apparence :</label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" name="theme" value="light" checked>
              <span data-i18n="options.light_theme">Thème clair</span>
            </label>
            <label class="radio-label">
              <input type="radio" name="theme" value="dark">
              <span data-i18n="options.dark_theme">Thème sombre</span>
            </label>
            <label class="radio-label">
              <input type="radio" name="theme" value="system">
              <span data-i18n="options.system_theme">Suivre le système</span>
            </label>
          </div>
        </div>
        
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="save-history">
            <span data-i18n="options.save_history">Enregistrer l'historique des requêtes</span>
          </label>
        </div>
        
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="use-web-workers">
            <span data-i18n="options.use_web_workers">Utiliser les Web Workers pour les traitements intensifs</span>
          </label>
        </div>
        
        <button id="save-general" class="primary-button" data-i18n="options.save_settings">Enregistrer les paramètres</button>
      </div>
      
      <!-- Onglet Modèles d'IA -->
      <div class="tab-pane" id="ai-models">
        <h2 class="section-title" data-i18n="options.ai_models_settings">Paramètres des modèles d'IA</h2>
        <p class="section-description" data-i18n="options.ai_models_description">Configurez les différents modèles d'IA que vous souhaitez utiliser.</p>
        
        <div class="models-container" id="models-container">
          <!-- Le contenu sera chargé dynamiquement depuis ai-models.html -->
        </div>
      </div>
      
      <!-- Onglet Prompts personnalisés -->
      <div class="tab-pane" id="custom-prompts">
        <h2 class="section-title" data-i18n="options.custom_prompts_settings">Prompts personnalisés</h2>
        <p class="section-description" data-i18n="options.custom_prompts_description">Créez et gérez vos propres modèles de prompts.</p>
        
        <div id="custom-prompts-container">
          <!-- Le contenu sera chargé dynamiquement depuis custom-prompts.html -->
        </div>
      </div>
      
      <!-- Onglet Historique -->
      <div class="tab-pane" id="history">
        <h2 class="section-title" data-i18n="options.history_settings">Historique des requêtes</h2>
        <p class="section-description" data-i18n="options.history_description">Consultez et gérez l'historique de vos requêtes.</p>
        
        <div id="history-container">
          <!-- Le contenu sera chargé dynamiquement depuis history.html -->
        </div>
      </div>
      
      <!-- Onglet Langue -->
      <div class="tab-pane" id="language">
        <h2 class="section-title" data-i18n="options.language_settings">Paramètres de langue</h2>
        <p class="section-description" data-i18n="options.language_description">Choisissez la langue de l'interface.</p>
        
        <div id="language-container">
          <!-- Le contenu sera chargé dynamiquement depuis language-settings.html -->
        </div>
      </div>
      
      <!-- Onglet À propos -->
      <div class="tab-pane" id="about">
        <h2 class="section-title" data-i18n="options.about">À propos de LucidSelect</h2>
        
        <div class="about-content">
          <div class="about-logo">
            <img src="../images/icon-192.png" alt="LucidSelect Logo" width="96" height="96">
          </div>
          
          <div class="about-info">
            <h3 data-i18n="options.version">Version</h3>
            <p id="extension-version">1.0.0</p>
            
            <h3 data-i18n="options.description">Description</h3>
            <p data-i18n="options.extension_description">LucidSelect est une extension qui vous permet d'interagir avec des modèles d'IA directement depuis votre navigateur. Sélectionnez du texte, posez des questions, obtenez des réponses.</p>
            
            <h3 data-i18n="options.features">Fonctionnalités</h3>
            <ul>
              <li data-i18n="options.feature_selection">Interaction avec du texte sélectionné</li>
              <li data-i18n="options.feature_prompts">Modèles de prompts personnalisés</li>
              <li data-i18n="options.feature_history">Historique des requêtes</li>
              <li data-i18n="options.feature_multilingual">Support multilingue</li>
              <li data-i18n="options.feature_models">Support de multiples modèles d'IA</li>
            </ul>
            
            <h3 data-i18n="options.credits">Crédits</h3>
            <p data-i18n="options.credits_text">Développé avec ❤️ par l'équipe LucidSelect.</p>
            
            <div class="about-links">
              <a href="https://github.com/votre-repo/LucidSelect" target="_blank" class="secondary-button" data-i18n="options.github">GitHub</a>
              <a href="https://votre-site.com/lucidselect" target="_blank" class="secondary-button" data-i18n="options.website">Site Web</a>
              <a href="https://votre-site.com/lucidselect/support" target="_blank" class="secondary-button" data-i18n="options.support">Support</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Conteneur pour les notifications -->
  <div id="notifications-container" class="notifications-container"></div>
  
  <!-- Scripts -->
  <script src="../utils/constants.js"></script>
  <script src="../utils/i18n.js"></script>
  <script src="../utils/performance.js"></script>
  <script src="../utils/history.js"></script>
  <script src="../utils/custom-prompts.js"></script>
  <script src="../utils/ai-models.js"></script>
  <script src="../ui/notifications.js"></script>
  <script src="../ui/multilingual-ui.js"></script>
  <script src="../ui/ai-models-ui.js"></script>
  <script src="../ui/custom-prompts-ui.js"></script>
  <script src="../ui/history-ui.js"></script>
  <script>
    // Initialisation de la page
    document.addEventListener('DOMContentLoaded', async () => {
      // Initialiser le gestionnaire de langues
      const i18nManager = new I18nManager();
      await i18nManager.initialize();
      
      // Mettre à jour l'interface avec les traductions
      i18nManager.updateUI();
      
      // Remplir le sélecteur de langues
      const languageSelector = document.getElementById('default-language');
      const supportedLanguages = i18nManager.getSupportedLanguages();
      const currentLanguage = i18nManager.getCurrentLanguage();
      
      // Vider le sélecteur
      languageSelector.innerHTML = '';
      
      // Ajouter les options de langue
      supportedLanguages.forEach(lang => {
        const option = document.createElement('option');
        option.value = lang.code;
        option.textContent = lang.name;
        option.selected = lang.code === currentLanguage;
        languageSelector.appendChild(option);
      });
      
      // Initialiser le gestionnaire de notifications
      const notificationsManager = new NotificationsManager();
      notificationsManager.initialize();
      
      // Charger les contenus dynamiques
      loadTabContent('ai-models', '../pages/ai-models.html');
      loadTabContent('custom-prompts', '../pages/custom-prompts.html');
      loadTabContent('history', '../pages/history.html');
      loadTabContent('language', '../pages/language-settings.html');
      
      // Gérer les onglets
      const tabs = document.querySelectorAll('.nav-tab');
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          // Désactiver tous les onglets
          tabs.forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
          
          // Activer l'onglet cliqué
          tab.classList.add('active');
          const tabId = tab.getAttribute('data-tab');
          document.getElementById(tabId).classList.add('active');
        });
      });
      
      // Charger les paramètres existants
      loadSettings();
      
      // Gérer l'enregistrement des paramètres généraux
      document.getElementById('save-general').addEventListener('click', saveGeneralSettings);
      
      // Afficher la version de l'extension
      chrome.runtime.getManifest().version;
      document.getElementById('extension-version').textContent = chrome.runtime.getManifest().version;
    });
    
    // Fonction pour charger le contenu d'un onglet depuis un fichier HTML
    async function loadTabContent(tabId, url) {
      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error(`Erreur HTTP: ${response.status}`);
        
        const html = await response.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        
        // Extraire le contenu principal (sans les scripts et le head)
        const container = document.getElementById(`${tabId}-container`);
        if (container) {
          // Trouver le premier élément div de niveau supérieur dans le body
          const mainContent = doc.body.querySelector(':scope > div');
          if (mainContent) {
            container.innerHTML = mainContent.innerHTML;
          }
          
          // Exécuter les scripts nécessaires
          const scripts = doc.querySelectorAll('script');
          scripts.forEach(script => {
            if (script.src) {
              // Ne pas recharger les scripts déjà chargés
              if (!document.querySelector(`script[src="${script.src}"]`)) {
                const newScript = document.createElement('script');
                newScript.src = script.src;
                document.body.appendChild(newScript);
              }
            } else if (script.textContent && !script.textContent.includes('DOMContentLoaded')) {
              // Exécuter le code inline, mais pas les initialisations DOMContentLoaded
              eval(script.textContent);
            }
          });
        }
      } catch (error) {
        console.error(`Erreur lors du chargement du contenu de l'onglet ${tabId}:`, error);
      }
    }
    
    // Fonction pour charger les paramètres existants
    async function loadSettings() {
      try {
        // Charger les paramètres depuis le stockage local
        const settings = await new Promise(resolve => {
          chrome.storage.local.get(['defaultModel', 'theme', 'saveHistory', 'useWebWorkers'], resolve);
        });
        
        // Appliquer les paramètres
        if (settings.defaultModel) {
          document.getElementById('default-model').value = settings.defaultModel;
        }
        
        if (settings.theme) {
          document.querySelector(`input[name="theme"][value="${settings.theme}"]`).checked = true;
        }
        
        if (settings.saveHistory !== undefined) {
          document.getElementById('save-history').checked = settings.saveHistory;
        } else {
          // Par défaut, activer l'enregistrement de l'historique
          document.getElementById('save-history').checked = true;
        }
        
        if (settings.useWebWorkers !== undefined) {
          document.getElementById('use-web-workers').checked = settings.useWebWorkers;
        } else {
          // Par défaut, activer l'utilisation des Web Workers
          document.getElementById('use-web-workers').checked = true;
        }
      } catch (error) {
        console.error('Erreur lors du chargement des paramètres:', error);
      }
    }
    
    // Fonction pour enregistrer les paramètres généraux
    async function saveGeneralSettings() {
      try {
        const defaultModel = document.getElementById('default-model').value;
        const defaultLanguage = document.getElementById('default-language').value;
        const theme = document.querySelector('input[name="theme"]:checked').value;
        const saveHistory = document.getElementById('save-history').checked;
        const useWebWorkers = document.getElementById('use-web-workers').checked;
        
        // Enregistrer les paramètres dans le stockage local
        await new Promise(resolve => {
          chrome.storage.local.set({
            defaultModel,
            defaultLanguage,
            theme,
            saveHistory,
            useWebWorkers
          }, resolve);
        });
        
        // Mettre à jour la langue si elle a changé
        const i18nManager = new I18nManager();
        const currentLanguage = await i18nManager.getCurrentLanguage();
        if (currentLanguage !== defaultLanguage) {
          await i18nManager.setLanguage(defaultLanguage);
          i18nManager.updateUI();
        }
        
        // Afficher une notification de succès
        const notificationsManager = new NotificationsManager();
        notificationsManager.showSuccess(i18nManager.translate('options.settings_saved'));
      } catch (error) {
        console.error('Erreur lors de l\'enregistrement des paramètres:', error);
        
        // Afficher une notification d'erreur
        const notificationsManager = new NotificationsManager();
        const i18nManager = new I18nManager();
        notificationsManager.showError(i18nManager.translate('options.settings_save_error'));
      }
    }
  </script>
  
  <style>
    /* Styles spécifiques à la page d'options */
    .options-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .options-navigation {
      margin-bottom: var(--spacing-lg);
      border-bottom: 1px solid var(--border-color);
    }
    
    .nav-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-xs);
    }
    
    .nav-tab {
      padding: var(--spacing-sm) var(--spacing-md);
      background: none;
      border: none;
      border-bottom: 2px solid transparent;
      cursor: pointer;
      font-weight: 500;
      color: var(--text-secondary);
      transition: color var(--transition-fast), border-color var(--transition-fast);
    }
    
    .nav-tab:hover {
      color: var(--primary-color);
    }
    
    .nav-tab.active {
      color: var(--primary-color);
      border-bottom-color: var(--primary-color);
    }
    
    .tab-content {
      min-height: 400px;
    }
    
    .tab-pane {
      display: none;
    }
    
    .tab-pane.active {
      display: block;
    }
    
    .form-group {
      margin-bottom: var(--spacing-lg);
    }
    
    .form-group label {
      display: block;
      margin-bottom: var(--spacing-xs);
      font-weight: 500;
    }
    
    .radio-group {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-sm);
    }
    
    .radio-label,
    .checkbox-label {
      display: flex;
      align-items: center;
      cursor: pointer;
    }
    
    .radio-label input,
    .checkbox-label input {
      margin-right: var(--spacing-sm);
    }
    
    .about-content {
      display: flex;
      gap: var(--spacing-xl);
      margin-top: var(--spacing-lg);
    }
    
    .about-logo {
      flex-shrink: 0;
    }
    
    .about-info {
      flex: 1;
    }
    
    .about-info h3 {
      margin-top: var(--spacing-lg);
      margin-bottom: var(--spacing-sm);
      color: var(--text-primary);
    }
    
    .about-info h3:first-child {
      margin-top: 0;
    }
    
    .about-links {
      display: flex;
      gap: var(--spacing-md);
      margin-top: var(--spacing-lg);
    }
    
    @media (max-width: 768px) {
      .about-content {
        flex-direction: column;
        align-items: center;
        text-align: center;
      }
      
      .about-links {
        justify-content: center;
      }
    }
  </style>
</body>
</html>